{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>{% if profile %}{{ profile.name }}{% else %}My Portfolio{% endif %}</title>

  <link rel="stylesheet" href="{% static 'style.css' %}?v=1001">
</head>

<body>

  <!-- NAV -->
  <div class="nav">
    <div class="nav-inner">
      <a class="brand" href="#home">
        {% if profile %}{{ profile.name }}{% else %}Portfolio{% endif %}
      </a>

      <button class="nav-toggle" id="navToggle">Menu</button>

      <div class="nav-links" id="navLinks">
        <a class="nav-link" href="#home">Home</a>
        <a class="nav-link" href="#projects">Projects</a>
        <a class="nav-link" href="#skills">Skills</a>
        <a class="nav-link" href="#experience">Experience</a>
        <a class="nav-link" href="#contact">Contact</a>
      </div>
    </div>
  </div>

  <div class="container" id="home">

    <!-- HERO -->
    <div class="section hero">
      <div class="hero-grid">
        <div class="card hero-card">
          <span class="pill">Recruiter-ready ‚Ä¢ Django ‚Ä¢ Admin Controlled</span>

          {% if profile %}
            <h1 class="hero-title">{{ profile.name }}</h1>
            <p class="hero-sub">{{ profile.headline }}</p>
            <p class="hero-bio">{{ profile.bio }}</p>

            <div class="links">
              {% if profile.github %}
                <a class="btn primary" href="{{ profile.github }}" target="_blank">GitHub</a>
              {% endif %}
              {% if profile.linkedin %}
                <a class="btn" href="{{ profile.linkedin }}" target="_blank">LinkedIn</a>
              {% endif %}
              {% if profile.resume_link %}
                <a class="btn ghost" href="{{ profile.resume_link }}" target="_blank">Resume (PDF)</a>
              {% endif %}
              {% if profile.email %}
                <a class="btn" href="mailto:{{ profile.email }}">Email</a>
              {% endif %}
            </div>

            <div class="micro">
              {% if profile.location %}<div class="micro-item">üìç {{ profile.location }}</div>{% endif %}
              <div class="micro-item">‚ö° Live Projects + Proof PDFs</div>
              <div class="micro-item">üß† ML + Forecasting + Deployment</div>
            </div>
          {% else %}
            <h1 class="hero-title">Portfolio</h1>
            <p class="hero-sub">Add your profile from <a class="inline-link" href="/admin/" target="_blank">/admin</a></p>
          {% endif %}
        </div>

        <div class="card hero-card">
          <h3 class="card-h">Quick Actions</h3>
          <ul class="bullets">
            <li>Add Profile, Skills, Projects, Experience from <a class="inline-link" href="/admin/" target="_blank">Admin Panel</a></li>
            <li>Projects can have Live Demo + GitHub + Image + PDF Proof</li>
            <li>Skills can have level tags (e.g., Intermediate, Advanced)</li>
          </ul>
        </div>
      </div>
    </div>

    <!-- PROJECTS -->
    <div class="section" id="projects">
      <div class="section-head">
        <h2>Projects</h2>
        <p class="muted">Search, filter by tech, and click a project card for full details.</p>
      </div>

      <div class="controls">
        <input class="input" id="searchBox" type="text" placeholder="Search projects (title/tech)..." />
        <select class="select" id="techFilter">
          <option value="all">All Tech</option>
        </select>
      </div>

      <!-- Featured -->
      <h3 class="subhead">Featured</h3>
      <div class="grid" id="featuredGrid">
        {% for p in projects %}
          {% if p.is_featured %}
            <div class="card project-card"
                 data-title="{{ p.title|escape }}"
                 data-tagline="{{ p.tagline|escape }}"
                 data-desc="{{ p.description|escape }}"
                 data-tech="{{ p.tech_stack|escape }}"
                 data-live="{{ p.live_demo|default:'' }}"
                 data-github="{{ p.github_repo|default:'' }}"
                 data-pdf="{% if p.pdf %}{{ p.pdf.url }}{% elif p.pdf_url %}{{ p.pdf_url }}{% else %}{% endif %}"
                 data-img="{% if p.image %}{{ p.image.url }}{% elif p.image_url %}{{ p.image_url }}{% else %}{% endif %}">
              <div class="card-top">
                <h3 class="card-h">{{ p.title }}</h3>
                <span class="badge">Featured</span>
              </div>
              <div class="tagline muted">{{ p.tagline }}</div>

              {% if p.image %}
                <img class="card-img" src="{{ p.image.url }}" alt="{{ p.title }}">
              {% elif p.image_url %}
                <img class="card-img" src="{{ p.image_url }}" alt="{{ p.title }}">
              {% endif %}

              <p class="desc">{{ p.description|truncatechars:160 }}</p>
              <p class="stack">Tech: {{ p.tech_stack }}</p>

              <div class="cardlinks">
                {% if p.live_demo %}<a href="{{ p.live_demo }}" target="_blank" onclick="event.stopPropagation()">Live</a>{% endif %}
                {% if p.github_repo %}<a href="{{ p.github_repo }}" target="_blank" onclick="event.stopPropagation()">GitHub</a>{% endif %}
                {% if p.pdf %}<a href="{{ p.pdf.url }}" target="_blank" onclick="event.stopPropagation()">PDF</a>
                {% elif p.pdf_url %}<a href="{{ p.pdf_url }}" target="_blank" onclick="event.stopPropagation()">PDF</a>{% endif %}
              </div>
            </div>
          {% endif %}
        {% endfor %}
      </div>

      <!-- All Projects -->
      <h3 class="subhead">All Projects</h3>
      <div class="grid" id="allGrid">
        {% for p in projects %}
          <div class="card project-card"
               data-title="{{ p.title|escape }}"
               data-tagline="{{ p.tagline|escape }}"
               data-desc="{{ p.description|escape }}"
               data-tech="{{ p.tech_stack|escape }}"
               data-live="{{ p.live_demo|default:'' }}"
               data-github="{{ p.github_repo|default:'' }}"
               data-pdf="{% if p.pdf %}{{ p.pdf.url }}{% elif p.pdf_url %}{{ p.pdf_url }}{% else %}{% endif %}"
               data-img="{% if p.image %}{{ p.image.url }}{% elif p.image_url %}{{ p.image_url }}{% else %}{% endif %}">
            <div class="card-top">
              <h3 class="card-h">{{ p.title }}</h3>
              {% if p.is_featured %}<span class="badge">Featured</span>{% endif %}
            </div>
            <div class="tagline muted">{{ p.tagline }}</div>

            {% if p.image %}
              <img class="card-img" src="{{ p.image.url }}" alt="{{ p.title }}">
            {% elif p.image_url %}
              <img class="card-img" src="{{ p.image_url }}" alt="{{ p.title }}">
            {% endif %}

            <p class="desc">{{ p.description|truncatechars:160 }}</p>
            <p class="stack">Tech: {{ p.tech_stack }}</p>

            <div class="cardlinks">
              {% if p.live_demo %}<a href="{{ p.live_demo }}" target="_blank" onclick="event.stopPropagation()">Live</a>{% endif %}
              {% if p.github_repo %}<a href="{{ p.github_repo }}" target="_blank" onclick="event.stopPropagation()">GitHub</a>{% endif %}
              {% if p.pdf %}<a href="{{ p.pdf.url }}" target="_blank" onclick="event.stopPropagation()">PDF</a>
              {% elif p.pdf_url %}<a href="{{ p.pdf_url }}" target="_blank" onclick="event.stopPropagation()">PDF</a>{% endif %}
            </div>
          </div>
        {% endfor %}
      </div>
    </div>

    <!-- SKILLS + EXPERIENCE -->
    <div class="section two-col">
      <div class="card" id="skills">
        <h2>Skills</h2>
        <p class="muted small">Add skills + levels from Admin.</p>

        {% if skills %}
          <div class="chips">
            {% for s in skills %}
              <span class="chip">{{ s.name }}{% if s.level %} ‚Ä¢ {{ s.level }}{% endif %}</span>
            {% endfor %}
          </div>
        {% else %}
          <p class="muted">Add skills from <a class="inline-link" href="/admin/" target="_blank">/admin</a></p>
        {% endif %}
      </div>

      <div class="card" id="experience">
        <h2>Experience</h2>
        <p class="muted small">Projects shipped, hackathons, internships, etc.</p>

        {% if experience %}
          <ul class="bullets">
            {% for e in experience %}
              <li>
                <b>{{ e.role }}</b>{% if e.org %} ‚Äî {{ e.org }}{% endif %}
                <div class="muted small">{{ e.start }}{% if e.end %} - {{ e.end }}{% endif %}</div>
                <div class="muted">{{ e.details|truncatechars:180 }}</div>
              </li>
            {% endfor %}
          </ul>
        {% else %}
          <p class="muted">Add experience from <a class="inline-link" href="/admin/" target="_blank">/admin</a></p>
        {% endif %}
      </div>
    </div>

    <!-- CONTACT -->
    <div class="section" id="contact">
      <h2>Contact</h2>
      <p class="muted">For internships, collaborations, or project discussions.</p>

      {% if profile %}
        <div class="contact-card">
          <div class="contact-row">
            <div>
              <div class="contact-main">{{ profile.email }}</div>
              <div class="muted small">
                {% if profile.location %}üìç {{ profile.location }}{% endif %}
              </div>
            </div>
            <div class="contact-actions">
              {% if profile.email %}<a class="btn" href="mailto:{{ profile.email }}">Email</a>{% endif %}
              {% if profile.github %}<a class="btn" href="{{ profile.github }}" target="_blank">GitHub</a>{% endif %}
              {% if profile.linkedin %}<a class="btn" href="{{ profile.linkedin }}" target="_blank">LinkedIn</a>{% endif %}
            </div>
          </div>
          <div class="divider"></div>
          <div class="muted small">¬© {% now "Y" %} {{ profile.name }} ‚Ä¢ Built with Django</div>
        </div>
      {% else %}
        <p class="muted">Add your profile from <a class="inline-link" href="/admin/" target="_blank">/admin</a></p>
      {% endif %}
    </div>

  </div>

  <!-- MODAL -->
  <div class="modal hidden" id="modal">
    <div class="modal-content">
      <button class="modal-close" id="modalClose">&times;</button>
      <h3 id="mTitle"></h3>
      <p class="muted" id="mTagline"></p>
      <img id="mImg" style="display:none; width:100%; border-radius:14px; margin:12px 0; border:1px solid rgba(255,255,255,.10);" alt="project image">
      <p id="mDesc"></p>
      <p class="muted"><b>Tech:</b> <span id="mTech"></span></p>

      <div class="modal-actions">
        <a class="linkbtn" id="mLive" href="#" target="_blank" style="display:none;">Live</a>
        <a class="linkbtn ghostbtn" id="mGit" href="#" target="_blank" style="display:none;">GitHub</a>
        <a class="linkbtn ghostbtn" id="mPdf" href="#" target="_blank" style="display:none;">PDF</a>
      </div>
    </div>
  </div>

  <script>
    // Mobile nav
    const navToggle = document.getElementById("navToggle");
    const navLinks = document.getElementById("navLinks");
    navToggle?.addEventListener("click", () => navLinks.classList.toggle("open"));
    navLinks?.querySelectorAll("a")?.forEach(a => a.addEventListener("click", () => navLinks.classList.remove("open")));

    // Build Tech dropdown
    const cards = Array.from(document.querySelectorAll(".project-card"));
    const techSet = new Set();
    cards.forEach(c => {
      const tech = (c.dataset.tech || "").split(",").map(x => x.trim()).filter(Boolean);
      tech.forEach(t => techSet.add(t.toLowerCase()));
    });

    const techFilter = document.getElementById("techFilter");
    [...techSet].sort().forEach(t => {
      const opt = document.createElement("option");
      opt.value = t;
      opt.textContent = t;
      techFilter.appendChild(opt);
    });

    const searchBox = document.getElementById("searchBox");

    function applyFilters() {
      const q = (searchBox.value || "").toLowerCase().trim();
      const tech = techFilter.value;

      cards.forEach(c => {
        const title = (c.dataset.title || "").toLowerCase();
        const tagline = (c.dataset.tagline || "").toLowerCase();
        const stack = (c.dataset.tech || "").toLowerCase();

        const matchQuery = !q || title.includes(q) || tagline.includes(q) || stack.includes(q);
        const matchTech = (tech === "all") || stack.split(",").map(x => x.trim()).includes(tech);

        c.style.display = (matchQuery && matchTech) ? "" : "none";
      });
    }

    searchBox?.addEventListener("input", applyFilters);
    techFilter?.addEventListener("change", applyFilters);

    // Modal
    const modal = document.getElementById("modal");
    const modalClose = document.getElementById("modalClose");
    const mTitle = document.getElementById("mTitle");
    const mTagline = document.getElementById("mTagline");
    const mDesc = document.getElementById("mDesc");
    const mTech = document.getElementById("mTech");
    const mImg = document.getElementById("mImg");
    const mLive = document.getElementById("mLive");
    const mGit = document.getElementById("mGit");
    const mPdf = document.getElementById("mPdf");

    function openModal(card){
      mTitle.textContent = card.dataset.title || "Project";
      mTagline.textContent = card.dataset.tagline || "";
      mDesc.textContent = card.dataset.desc || "";
      mTech.textContent = card.dataset.tech || "";

      const img = card.dataset.img || "";
      if(img){
        mImg.src = img;
        mImg.style.display = "";
      } else {
        mImg.style.display = "none";
      }

      const live = card.dataset.live || "";
      const git = card.dataset.github || "";
      const pdf = card.dataset.pdf || "";

      mLive.style.display = live ? "" : "none";
      mGit.style.display = git ? "" : "none";
      mPdf.style.display = pdf ? "" : "none";

      if(live) mLive.href = live;
      if(git) mGit.href = git;
      if(pdf) mPdf.href = pdf;

      modal.classList.remove("hidden");
    }

    function closeModal(){ modal.classList.add("hidden"); }

    cards.forEach(c => c.addEventListener("click", () => openModal(c)));
    modalClose?.addEventListener("click", closeModal);
    modal?.addEventListener("click", (e) => { if(e.target === modal) closeModal(); });
    document.addEventListener("keydown", (e) => { if(e.key === "Escape") closeModal(); });

    // Active nav highlight
    const navA = Array.from(document.querySelectorAll(".nav-link"));
    const sections = ["home","projects","skills","experience","contact"].map(id => document.getElementById(id)).filter(Boolean);

    window.addEventListener("scroll", () => {
      let current = "home";
      sections.forEach(sec => {
        const top = sec.offsetTop - 120;
        if(window.scrollY >= top) current = sec.id;
      });
      navA.forEach(a => a.classList.toggle("active", a.getAttribute("href") === "#" + current));
    });
  </script>

</body>
</html>